import{_ as M,r as l,c as N,h as T,i as F,o as r,a as n,b as t,d as S,e as b,v as k,t as d,f as V,w as j,F as I,g as x}from"./index-Cq_WT0L-.js";const A={class:"admin-container"},U={key:0,class:"admin-card"},q={class:"form-group"},D={key:0,class:"error-message"},O=["disabled"],P={key:1,class:"interface-card"},z={class:"stats"},G={class:"lottery-settings"},J={class:"all-lotteries"},R={key:0,class:"lottery-results"},$={__name:"AdminView",setup(H){const u=l(""),f=l(0),h=l(0),c=l(1),i=l([]),v=l([]),a=l(""),p=l(!1),w=l("");let m=null;const E=N(()=>u.value.trim()!==""&&a.value===""),B=()=>{u.value.trim()===""?a.value="密碼不能為空":a.value=""},C=async()=>{try{const s=await fetch("https://lottery-system.onrender.com/admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:u.value})});if(!s.ok)throw new Error("登入失敗");const e=await s.json();w.value=e.token,p.value=!0,a.value="",await g(),_()}catch(s){console.error("Error logging in:",s),a.value="登入失敗，請稍後再試"}},g=async()=>{try{const s=await fetch("https://lottery-system.onrender.com/lottery",{method:"GET",headers:{Authorization:`Bearer ${w.value}`}});if(!s.ok)throw new Error("查詢失敗");const e=await s.json();f.value=e.lotteries.length,h.value=e.lotteries.length,i.value=e.lotteries,console.log("Fetched lotteries:",i.value)}catch(s){console.error("Error fetching lotteries:",s),a.value="查詢失敗，請稍後再試"}},L=()=>{const s=[];for(let e=0;e<c.value;e++){const o=Math.floor(Math.random()*i.value.length);s.push(i.value[o]),i.value.splice(o,1)}v.value=s},_=()=>{m=setInterval(g,3e4)};return T(()=>{p.value&&_()}),F(()=>{m&&clearInterval(m)}),(s,e)=>(r(),n("div",A,[p.value?(r(),n("div",P,[e[7]||(e[7]=t("h1",null,"抽獎系統",-1)),t("div",z,[t("p",null,"目前參與人數："+d(f.value),1),t("p",null,"目前抽獎券數："+d(h.value),1)]),t("div",G,[e[4]||(e[4]=t("p",null,"抽獎數設定",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),type:"number",min:"1"},null,512),[[k,c.value]])]),t("button",{onClick:L},"開始抽獎"),t("div",J,[e[5]||(e[5]=t("h2",null,"目前抽獎序號",-1)),t("ul",null,[(r(!0),n(I,null,x(i.value,(o,y)=>(r(),n("li",{key:y},d(o),1))),128))])]),v.value.length?(r(),n("div",R,[e[6]||(e[6]=t("h2",null,"抽獎結果",-1)),t("ul",null,[(r(!0),n(I,null,x(v.value,(o,y)=>(r(),n("li",{key:y},d(o),1))),128))])])):V("",!0)])):(r(),n("div",U,[e[3]||(e[3]=t("h1",null,"管理員登入",-1)),t("form",{onSubmit:j(C,["prevent"]),class:"admin-form"},[t("div",q,[e[2]||(e[2]=t("label",{for:"password"},[S("密碼 "),t("span",{class:"required"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),type:"password",id:"password",name:"password",required:"",onBlur:B},null,544),[[k,u.value]]),a.value?(r(),n("span",D,d(a.value),1)):V("",!0)]),t("button",{type:"submit",disabled:!E.value},"登入",8,O)],32)]))]))}},Q=M($,[["__scopeId","data-v-bf74b5d0"]]);export{Q as default};
